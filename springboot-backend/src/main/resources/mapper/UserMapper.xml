<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.admin.mapper.UserMapper">

    <!-- 查询用户节点权限详情 -->
    <select id="getUserNodeDetails" resultType="com.admin.common.dto.UserPackageDto$UserNodeDetailDto">
        SELECT 
            un.id,
            un.user_id as userId,
            un.node_id as nodeId,
            n.name as nodeName,
            n.ip as ip,
            n.server_ip as serverIp
        FROM user_node un
        LEFT JOIN node n ON un.node_id = n.id
        WHERE un.user_id = #{userId}
        ORDER BY un.id
    </select>

    <!-- 查询用户转发详情（连表查询隧道信息） -->
    <select id="getUserForwardDetails" resultType="com.admin.common.dto.UserPackageDto$UserForwardDetailDto">
        SELECT 
            f.id,
            f.name,
            f.tunnel_id as tunnelId,
            t.name as tunnelName,
            t.in_ip as inIp,
            f.in_port as inPort,
            f.remote_addr as remoteAddr,
            f.in_flow as inFlow,
            f.out_flow as outFlow,
            f.status,
            f.created_time as createdTime
        FROM forward f
        LEFT JOIN tunnel t ON f.tunnel_id = t.id
        WHERE f.user_id = #{userId}
        ORDER BY f.created_time DESC
    </select>

    
</mapper>
